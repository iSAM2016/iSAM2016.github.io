# 1. 为什么需要设计数据库

## 1.1 良好的数据库设计

节省数据的存储空间
能够保证数据的完整性
方便进行数据库系统的开发

## 1.2 糟糕的数据库设计

数据冗余，存储空间浪费
内存空间浪费
数据和更新插入异常

# 2. 软件项目开发周期中的数据库设计

- 需求分析阶段: 分析客户的业务和数据处理需求
- 概要设计阶段： 设计数据库的 E-R 模型图，确认需求的正确和完整性
- 详细设计阶段： 应用三大范式审核数据库
- 代码编写阶段： 物理实现数据库，编码实现应用
- 软件测试阶段

- 安装部署

  现实世界->信息世界->数据库模型图->数据库

# 3.设计数据库的步骤

## 3.1 收集信息

与相关人员进行交流、访谈充分了解用户需求，理解数据库需要完成的任务

## 3.2 标示实体(Entity)

标识数据库要管理的关键对象或者实体，实体一般是名词

## 3.3 标示实体的属性(Attribute)

## 3.4 标示实体之间的关系(RelationShip)

4. 数据库 ER 图
   ER 图：实体关系图，简记 E-R 图，是指以实体、关系、属性三个基本概念概括数据的基本结构，从而描述静态数据结构的概念模式 er

## 4.1 ER 图的实体（entity）

    ER 图的实体（entity）即数据模型中的数据对象，例如人、学生、音乐都可以作为一个数据对象，用长方体来表示

## 4.2 ER 图的属性（attribute）

ER 图的属性（attribute）即数据对象所具有的属性，例如学生具有姓名、学号、年级等属性，用椭圆形表示
属性分为唯一属性（ unique attribute）和非唯一属性
唯一属性指的是唯一可用来标识该实体实例或者成员的属性，用下划线表示，一般来讲实体都至少有一个唯一属性。

## 4.3 ER 图的关系（relationship）

ER 图的关系（relationship）用来表现数据对象与数据对象之间的联系
例如学生的实体和成绩表的实体之间有一定的联系，每个学生都有自己的成绩表，这就是一种关系，关系用菱形来表示。

## 4.4 ER 图中关联关系

# 6.事务

## 6.1 为什么需要事务

- 银行转账问题
- A 账户资金减少
- B 账户资金增加

```
  create database bank;
  use bank;
  create table account
  (
  name varchar(64),
  balance decimal(10,2)
  )
  insert into account(name,balance) values('张三',100);
  insert into account(name,balance) values('李四',100);

update account set balance = balance - 10 where name = '张三';
update account set balance = balance + 10 where name = '李四';
```

# 6.2 什么是事务

- 事务是作为单个逻辑工作单元执行的一系列操作
- 多个操作作为一个整体向系统提交，要么都执行，要么都不执行
- 事务是一个不可分割的工作逻辑单元

  > 转账过程就是一个整体，它需要两条 UPDATE 语句，如果任何一个出错，则整个转账业务取消，两个账户的余额都恢复到原来的数据，确保总余额不变

# 6.3 事务的特性

- 原子性事务是一个完整的操作，事务各个部分是不可分割的部分，要么都执行，要么都不执行

* 一致性当事务完成以后，数据必须处理完成的状态
* 隔离性： 并发事务彼此隔离、独立，他不应该以任何方式依赖于其他事务
* 持久性：事务完成以后，他对数据库的修改被永久保持

# 6.4 如何创建事务

- 开始事务 START TRANSACTION 或者 BEGIN
- 提交事务 COMMIT
- 回滚或者说撤销事务 ROLLBACK

```
BEGIN;
update account set balance = balance - 10 where name = '张三';
ROLLBACK;
```

- 默认情况下，每条单独的 SQL 语句视为一个事务
- 关闭默认提交状态后，可手动开启、关闭事务
- 关闭/开启自动提交状态 SET autocommit 0|1 0 关闭 1 开启
  > 关闭自动提交后，从下一条 SQL 语句开始开启新的事务，需要使用 COMMIT 或 ROLLBACK 结束该事务
